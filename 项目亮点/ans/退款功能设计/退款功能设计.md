```
京东plus退款设计
告诉所有人退款系统要怎么设计

用户点击退款按钮
消息队列：判断下单时间、是否信誉用户、是否发货状态
生成退款订单、通知商家、商家处理
对接各个三方退款账号：商家银行退款、商家银行的退款到账回调通知
通知商家与用户

银行回调失败：
自动查询外部订单状态
对接我方银行的付款、对接我方银行的回调

什么权限获得商家支付权限
防重复退款








京东闪电退款怎么这么快？下面的gif图也就2秒的功夫，退款直接打到了银行账号。

支付：
成功或者失败都没有回调通知：重复支付、取消订单不会收到退款
避免重复支付：
检查是否有成功的支付记录
```





```shell
http {
    # 以客户端 IP 为依据
    limit_req_zone $binary_remote_addr zone=ip_limit:10m rate=10r/s;

    server {
        location / {
            # 应用限流规则
            limit_req zone=ip_limit burst=20 nodelay;
            proxy_pass http://backend;
        }
    }
}

http {
    # 以 URL 的路径作为依据
    limit_req_zone $request_uri zone=url_limit:10m rate=20r/s;

    server {
        location /api/specific/ {
            # 应用 URL 限流规则
            limit_req zone=url_limit burst=30;
            proxy_pass http://backend;
        }
    }
}
```

